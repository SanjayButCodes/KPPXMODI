<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KPPXMODI</title>

<style>
* { box-sizing: border-box; font-family: Arial, sans-serif; }

body {
  margin: 0;
  background: linear-gradient(135deg, #5dc7d8, #4aa3b3);
  height: 100vh;
  overflow: hidden;
  color: white;
}

.screen {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 20px;
  opacity: 0;
  pointer-events: none;
  transform: scale(0.95);
  transition: 0.4s ease;
}

.screen.active {
  opacity: 1;
  pointer-events: auto;
  transform: scale(1);
}

h1 { font-size: 42px; }

button {
  padding: 14px 28px;
  font-size: 18px;
  border: none;
  border-radius: 8px;
  background: #ffcc00;
  color: black;
  cursor: pointer;
}
button:hover { transform: scale(1.05); }

input {
  padding: 12px;
  font-size: 18px;
  border-radius: 6px;
  border: none;
  width: 220px;
}

canvas { background: #70c5ce; }

#github {
  position: fixed;
  bottom: 10px;
  right: 10px;
  color: white;
  text-decoration: none;
  font-size: 14px;
}
</style>
</head>

<body>

<!-- ===== MAIN MENU ===== -->
<div id="menu" class="screen active">
  <h1>KPPXMODI</h1>
  <button onclick="goName()">‚ñ∂ Play</button>
  <button onclick="goLeaderboard()">üèÜ Leaderboard</button>
</div>

<!-- ===== NAME INPUT ===== -->
<div id="nameScreen" class="screen">
  <h1>Enter Name</h1>
  <input id="nameInput" placeholder="Your name">
  <button onclick="startGame()">Start</button>
</div>

<!-- ===== LEADERBOARD ===== -->
<div id="leaderboardScreen" class="screen">
  <h1>Leaderboard</h1>
  <div id="leaderboardList"></div>
  <button onclick="goMenu()">‚¨Ö Back</button>
</div>

<!-- ===== GAME ===== -->
<div id="gameScreen" class="screen">
  <canvas id="game" width="400" height="600"></canvas>

  <!-- GAME OVER OPTIONS -->
  <div id="gameOverUI" style="display:none; gap:14px; flex-direction:column;">
    <button onclick="restartGame()">üîÅ Restart</button>
    <button onclick="goMenu()">üè† Main Menu</button>
  </div>
</div>

<a id="github" href="https://github.com/SanjayButCodes" target="_blank">GitHub</a>

<script>
/* ========== STATE / NAV ========== */
const screens = { menu, name:nameScreen, leaderboard:leaderboardScreen, game:gameScreen };
function show(s){
  Object.values(screens).forEach(sc=>sc.classList.remove("active"));
  screens[s].classList.add("active");
}
function goMenu(){ show("menu"); }
function goName(){ show("name"); }
function goLeaderboard(){ renderLeaderboard(); show("leaderboard"); }

/* ========== NAME & SCORES ========== */
let playerName = localStorage.getItem("playerName") || "";
let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
let playerHighScore = 0;

function startGame(){
  const n = nameInput.value.trim();
  if(!n) return;
  playerName = n;
  localStorage.setItem("playerName", playerName);

  const entry = leaderboard.find(e => e.name === playerName);
  playerHighScore = entry ? entry.score : 0;

  resetGame();
  gameOverUI.style.display="none";
  show("game");
}

/* ========== LEADERBOARD ========== */
function saveScore(){
  const entry = leaderboard.find(e => e.name === playerName);
  if(entry){
    if(score > entry.score) entry.score = score;
  } else {
    leaderboard.push({ name: playerName, score });
  }
  leaderboard.sort((a,b)=>b.score-a.score);
  leaderboard = leaderboard.slice(0,5);
  localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
  playerHighScore = Math.max(playerHighScore, score);
}

function renderLeaderboard(){
  leaderboardList.innerHTML = leaderboard
    .map((e,i)=>`<div>${i+1}. ${e.name} ‚Äî ${e.score}</div>`)
    .join("");
}

/* ========== GAME LOGIC ========== */
const canvas = game, ctx = canvas.getContext("2d");
const birdImg=new Image(); birdImg.src="bird.png";
const pipeImg=new Image(); pipeImg.src="pillar.png";
const deathImg=new Image(); deathImg.src="death.png";

const flapSound=new Audio("click.mp3");
const dieSound=new Audio("die.mp3");
let currentSound=null;

function playSound(s,force=false){
  if(currentSound&&!force) return;
  if(currentSound&&force) currentSound.pause();
  currentSound=s; s.currentTime=0; s.play();
  s.onended=()=>currentSound=null;
}

let bird,pipes,frame,score,gameOver=false;

document.body.addEventListener("click",()=>{
  if(!gameOver && screens.game.classList.contains("active")){
    bird.velocity=bird.lift;
    playSound(flapSound);
  }
});

function resetGame(){
  bird={x:80,y:250,w:40,h:40,velocity:0,gravity:0.4,lift:-8,rotation:0};
  pipes=[]; frame=0; score=0; gameOver=false;
}

function restartGame(){
  if(currentSound===dieSound) return;
  resetGame();
  gameOverUI.style.display="none";
}

function addPipe(){
  const gap=190, top=Math.random()*220+60;
  pipes.push({x:400,top,bottom:top+gap,w:60,passed:false});
}

function update(){
  if(gameOver || !screens.game.classList.contains("active")) return;

  bird.velocity+=bird.gravity;
  bird.velocity*=0.98;
  bird.y+=bird.velocity;
  bird.rotation=Math.min(Math.max(bird.velocity*0.05,-0.5),1);

  if(frame%110===0) addPipe();
  frame++;

  pipes.forEach(p=>{
    p.x-=1.6;
    if(bird.x<p.x+p.w&&bird.x+bird.w>p.x&&(bird.y<p.top||bird.y+bird.h>p.bottom)){
      gameOver=true;
      playSound(dieSound,true);
      saveScore();
      gameOverUI.style.display="flex";
    }
    if(!p.passed&&p.x+p.w<bird.x){score++;p.passed=true;}
  });
}

function draw(){
  if(!screens.game.classList.contains("active")) return;
  ctx.clearRect(0,0,400,600);

  pipes.forEach(p=>{
    ctx.drawImage(pipeImg,p.x,0,p.w,p.top);
    ctx.drawImage(pipeImg,p.x,p.bottom,p.w,600);
  });

  ctx.save();
  ctx.translate(bird.x+20,bird.y+20);
  ctx.rotate(bird.rotation);
  ctx.drawImage(birdImg,-20,-20,40,40);
  ctx.restore();

  // SCORE + HIGHSCORE (TOP LEFT)
  ctx.fillStyle="white";
  ctx.font="18px Arial";
  ctx.fillText(`Score: ${score}  |  High: ${playerHighScore}`, 12, 24);

  if(gameOver) ctx.drawImage(deathImg,50,200,300,200);
}

function loop(){ update(); draw(); requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>
